!function t(e,i,n){function o(s,f){if(!i[s]){if(!e[s]){var a="function"==typeof require&&require;if(!f&&a)return a(s,!0);if(r)return r(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[s]={exports:{}};e[s][0].call(h.exports,function(t){var i=e[s][1][t];return o(i?i:t)},h,h.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,i){"use strict";var n=t("object-keys"),o=t("foreach"),r="function"==typeof Symbol&&"symbol"==typeof Symbol(),s=Object.prototype.toString,f=function(t){return"function"==typeof t&&"[object Function]"===s.call(t)},a=function(){var t={};try{Object.defineProperty(t,"x",{enumerable:!1,value:t});for(var e in t)return!1;return t.x===t}catch(i){return!1}},l=Object.defineProperty&&a(),h=function(t,e,i,n){(!(e in t)||f(n)&&n())&&(l?Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:i,writable:!0}):t[e]=i)},u=function(t,e){var i=arguments.length>2?arguments[2]:{},s=n(e);r&&(s=s.concat(Object.getOwnPropertySymbols(e))),o(s,function(n){h(t,n,e[n],i[n])})};u.supportsDescriptors=!!l,e.exports=u},{foreach:4,"object-keys":2}],2:[function(t,e,i){"use strict";var n=Object.prototype.hasOwnProperty,o=Object.prototype.toString,r=Array.prototype.slice,s=t("./isArguments"),f=Object.prototype.propertyIsEnumerable,a=!f.call({toString:null},"toString"),l=f.call(function(){},"prototype"),h=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],u=function(t){var e=t.constructor;return e&&e.prototype===t},c={$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},m=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!c["$"+t]&&n.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{u(window[t])}catch(e){return!0}}catch(e){return!0}return!1}(),p=function(t){if("undefined"==typeof window||!m)return u(t);try{return u(t)}catch(e){return!1}},d=function(t){var e=null!==t&&"object"==typeof t,i="[object Function]"===o.call(t),r=s(t),f=e&&"[object String]"===o.call(t),u=[];if(!e&&!i&&!r)throw new TypeError("Object.keys called on a non-object");var c=l&&i;if(f&&t.length>0&&!n.call(t,0))for(var m=0;m<t.length;++m)u.push(String(m));if(r&&t.length>0)for(var d=0;d<t.length;++d)u.push(String(d));else for(var y in t)c&&"prototype"===y||!n.call(t,y)||u.push(String(y));if(a)for(var g=p(t),v=0;v<h.length;++v)g&&"constructor"===h[v]||!n.call(t,h[v])||u.push(h[v]);return u};d.shim=function(){if(Object.keys){var t=function(){return 2===(Object.keys(arguments)||"").length}(1,2);if(!t){var e=Object.keys;Object.keys=function(t){return e(s(t)?r.call(t):t)}}}else Object.keys=d;return Object.keys||d},e.exports=d},{"./isArguments":3}],3:[function(t,e,i){"use strict";var n=Object.prototype.toString;e.exports=function(t){var e=n.call(t),i="[object Arguments]"===e;return i||(i="[object Array]"!==e&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===n.call(t.callee)),i}},{}],4:[function(t,e,i){var n=Object.prototype.hasOwnProperty,o=Object.prototype.toString;e.exports=function(t,e,i){if("[object Function]"!==o.call(e))throw new TypeError("iterator must be a function");var r=t.length;if(r===+r)for(var s=0;s<r;s++)e.call(i,t[s],s,t);else for(var f in t)n.call(t,f)&&e.call(i,t[f],f,t)}},{}],5:[function(t,e,i){(function(t){"use strict";"undefined"!=typeof self?e.exports=self:"undefined"!=typeof window?e.exports=window:"undefined"!=typeof t?e.exports=t:e.exports=Function("return this")()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(t,e,i){"use strict";var n=t("define-properties"),o=t("./implementation"),r=t("./polyfill"),s=t("./shim"),f=r(),a=function(){return f};n(a,{getPolyfill:r,implementation:o,shim:s}),e.exports=a},{"./implementation":5,"./polyfill":7,"./shim":8,"define-properties":1}],7:[function(t,e,i){(function(i){"use strict";var n=t("./implementation");e.exports=function(){return"object"==typeof i&&i&&i.Math===Math&&i.Array===Array?i:n}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./implementation":5}],8:[function(t,e,i){(function(i){"use strict";var n=t("define-properties"),o=t("./polyfill");e.exports=function(){var t=o();if(n.supportsDescriptors){var e=Object.getOwnPropertyDescriptor(t,"global");(!e||e.configurable&&(e.enumerable||e.writable||i!==t))&&Object.defineProperty(t,"global",{configurable:!0,enumerable:!1,value:t,writable:!1})}else"object"==typeof i&&i===t||(t.global=t);return t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polyfill":7,"define-properties":1}],9:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=t("system.global")(),s=t("./StaticComment"),f=t("./ScrollComment"),a=function(){function t(e){n(this,t),this.commentLine=[],this.nowLine=[],this.position=0,this.options={indexOffset:0,className:"cmt",margin:1,global:{opacity:1,scale:1},scroll:{opacity:1,scale:1},limit:0},this.stage=e,this.width=e.offsetWidth,this.height=e.offsetHeight}return o(t,[{key:"startTimer",value:function(){for(var t=0;t<this.nowLine.length;t++)this.nowLine[t].control&&this.nowLine[t].start()}},{key:"stopTimer",value:function(){for(var t=0;t<this.nowLine.length;t++)this.nowLine[t].control&&this.nowLine[t].stop()}},{key:"_nowLinePush",value:function(t){if(0===this.nowLine.length)return void this.nowLine.push(t);if(this.nowLine[this.nowLine.length-1].offsetY()<=t.offsetY())return void this.nowLine.push(t);if(this.nowLine[0].offsetY()>=t.offsetY())return void this.nowLine.unshift(t);for(var e=0,i=this.nowLine.length-1,n=0,o=0;e<i;){if(n=Math.floor((i+e+1)/2),this.nowLine[n-1].offsetY()<=t.offsetY()&&this.nowLine[n].offsetY()>=t.offsetY()){o=n;break}this.nowLine[n-1].offsetY()>t.offsetY()?i=n-1:e=n}this.nowLine.splice(o,0,t)}},{key:"_removeFromStage",value:function(t){var e=this.nowLine.indexOf(t);e>=0&&this.nowLine.splice(e,1)}},{key:"setBounds",value:function(){this.width=this.stage.offsetWidth,this.height=this.stage.offsetHeight}},{key:"init",value:function(){this.setBounds(),this.position=0}},{key:"send",value:function(t){var e;if(5===t.mode||4===t.mode)e=new s(this,t);else{if(1!==t.mode&&2!==t.mode&&6!=t.mode)return void console.log("不支持的弹幕");e=new f(this,t)}e.init(),this.stage.appendChild(e.dom),e.layout(),this._nowLinePush(e)}},{key:"seek",value:function(t){this.position=0,this.position=this._locate(t)}},{key:"_locate",value:function(t){for(var e=this.position;e<this.commentLine.length;e++){var i=this.commentLine[e];if(i.stime>=t)return e}return this.commentLine.length}},{key:"time",value:function(t){if(0!==this.nowLine.length||this.position!==this.commentLine.length){if(t-=1,this.position<this.commentLine.length){for(var e=this._locate(t);this.position<e;this.position++)this.send(this.commentLine[this.position]);this.position=e}for(var i=this.nowLine.length,n=0;n<i;n++){var o=this.nowLine[n];o.checkTime(t)||(this.remove(o),i--)}}}},{key:"load",value:function(t){this.commentLine=t,this.position=0,this.commentLine.sort(function(t,e){return t.stime>=e.stime?1:-1})}},{key:"remove",value:function(t){this._removeFromStage(t),this.stage.removeChild(t.dom)}},{key:"clear",value:function(){for(;this.nowLine.length>0;)this.remove(this.nowLine[0])}}]),t}();r.CommentManager=a,e.exports=a},{"./ScrollComment":11,"./StaticComment":12,"system.global":6}],10:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(){function t(e,i){n(this,t),this.align=0,this.index=0,this.mode=1,this.stime=0,this.text="",this._size=20,this._color=16777215,this.control=!1,this._border=!1,this.lifeTime=4e3*e.options.global.scale,this.manager=e,i.hasOwnProperty("align")&&(this.align=i.align),i.hasOwnProperty("stime")&&(this.stime=i.stime),i.hasOwnProperty("text")&&(this.text=i.text),i.hasOwnProperty("mode")&&(this.mode=i.mode),i.hasOwnProperty("color")&&(this._color=i.color),i.hasOwnProperty("size")&&(this._size=i.size),i.hasOwnProperty("x")&&(this._x=i.x),i.hasOwnProperty("y")&&(this._y=i.y),i.hasOwnProperty("border")&&(this._border=i.border)}return o(t,[{key:"offsetX",value:function(t){return null===t||void 0===t?(null!==this._x&&void 0!==this._x||(this.align%2===0?this._x=this.dom.offsetLeft-this.manager.stage.offsetLeft:this._x=this.manager.stage.offsetWidth-(this.dom.offsetLeft-this.manager.stage.offsetLeft+this.dom.offsetWidth)),this._x):(this._x=t,void(this.align%2===0?this.dom.style.right=this._x+"px":this.dom.style.left=this._x+"px"))}},{key:"offsetY",value:function(t){return null===t||void 0===t?(null!==this._y&&void 0!==this._y||(this.align<2?this._y=this.dom.offsetTop:this._y=this.manager.stage.offsetHeight-(this.dom.offsetTop+this.dom.offsetHeight)),this._y):(this._y=t,void(this.align<2?this.dom.style.top=this._y+"px":this.dom.style.top=this.manager.stage.offsetHeight-t-this.dom.offsetHeight+"px"))}},{key:"Color",value:function(t){if(null===t||void 0===t)return this._color;this._color=t;var e=t.toString(16);e=e.length>=6?e:new Array(6-e.length+1).join("0")+e,0!==e.indexOf("#")&&(e="#".concat(e)),this.dom.style.color=e,0===this._color&&(this.dom.className=this.manager.options.className+" rshadow")}},{key:"Width",value:function(t){return null===t||void 0===t?(null!==this._width&&void 0!==this._width||(this._width=this.dom.offsetWidth),this._width):(this._width=t,void(this.dom.style.width=this._width+"px"))}},{key:"Height",value:function(t){return null===t||void 0===t?(null!==this._height&&void 0!==this._height||(this._height=this.dom.offsetHeight),this._height):(this._height=t,void(this.dom.style.height=this._height+"px"))}},{key:"Size",value:function(t){return null===t||void 0===t?this._size:(this._size=t,void(this.dom.style.fontSize=this._size+"px"))}},{key:"Border",value:function(t){return null===t||void 0===t?this._border:(this._border=t,void(this.dom.style.border=t))}},{key:"init",value:function(){var t=document.createElement("div");t.className=this.manager.options.className,t.appendChild(document.createTextNode(this.text)),t.textContent=this.text,t.innerText=this.text,this.dom=t,this._border&&(t.style.border="2px solid red"),this.Color(this._color),this.Size(this._size)}},{key:"checkTime",value:function(t){return this.stime+this.lifeTime>=t}},{key:"layout",value:function(){}},{key:"stop",value:function(){}},{key:"start",value:function(){}}]),t}();e.exports=r},{}],11:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),f=t("./CommentObject"),a=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));switch(r.mode){case 1:r.align=0;break;case 2:r.align=2;break;case 6:r.align=1}return r.follow=!1,r.control=!0,r.lifeTime*=t.options.scroll.scale,r.moving=!1,r.timeOffset=700,r}return r(e,t),s(e,[{key:"layout",value:function(){for(var t=0,e=this.Size()+2*this.manager.options.margin,i=0,n=-1,o=this.Width();n<0;){if(t>1e3)return;n=this._findOffsetY(t,e,i),t++,i+=this.manager.options.indexOffset}this.index=t-1,this.offsetY(n),this.dom.style.right="-"+o+"px",this.dom.style.left="-"+o+"px",this.moveAnimation()}},{key:"_findOffsetY",value:function(t,e,i){for(var n,o=i,r=0;r<this.manager.nowLine.length;r++)if(n=this.manager.nowLine[r],n.mode===this.mode&&n.index===t){if(n.offsetY()-o>=e)return o;if(!n.follow&&n.timeLeft<=.5*n.lifeTime)return n.follow=!0,n.offsetY();o=n.offsetY()+n.Height()}return o+e<=this.manager.stage.offsetHeight?o:-1}},{key:"transform",value:function(t){this.dom.style.transform=t,this.dom.style.webkitTransform=t,this.dom.style.msTransform=t,this.dom.style.oTransform=t}},{key:"moveTransform",value:function(){if(!this.moving){var t=-(this.manager.width+this.Width());this.transform("translateX("+t+"px)"),this.dom.style.transition="transform "+this.lifeTime+"ms linear",this.moving=!0}}},{key:"moveAnimation",value:function(){var t=this.align%2==0?"-left ":"-right ",e="cmt-move"+t+this.lifeTime/1e3+"s linear";this.dom.style.animation=e,this.dom.style["-webkit-animation"]=e,this.dom.style["-moz-animation"]=e,this.dom.style["-o-animation"]=e}},{key:"start",value:function(){this.dom.style["animation-play-state"]="running"}},{key:"stop",value:function(){this.dom.style["animation-play-state"]="paused"}},{key:"checkTime",value:function(t){return this.stime+this.lifeTime+this.timeOffset>=t}}]),e}(f);e.exports=a},{"./CommentObject":10}],12:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),f=t("./CommentObject"),a=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return r.align=4==r.mode?3:0,r}return r(e,t),s(e,[{key:"_findOffsetY",value:function(t,e,i){var n=i;for(var o in this.manager.nowLine){var r=this.manager.nowLine[o];if(r.mode===this.mode&&r.index===t){if(r.offsetY()-n>=e)return n;n=r.offsetY()+r.Height()}}return n+e<=this.manager.stage.offsetHeight?n:-1}},{key:"layout",value:function(){for(var t=0,e=this.Height()+2*this.manager.options.margin,i=0,n=-1;n<0;)n=this._findOffsetY(t,e,i),t++,i+=this.manager.options.indexOffset;this.index=t-1,this.offsetX(this.manager.stage.offsetLeft+(this.manager.stage.offsetWidth-this.Width())/2),this.offsetY(n)}}]),e}(f);e.exports=a},{"./CommentObject":10}]},{},[9]);